<odoo>
    <template id="report_invoice_with_downpayment_lines">
        <t t-call="account.report_invoice">
            <t t-set="print_with_downpayment_lines" t-value="True"/>
        </t>
    </template>

    <template id="inherit_report_invoice_document" inherit_id="account.report_invoice_document">
        <xpath expr="//table[@name='invoice_line_table']/tbody" position="replace">
            <tbody class="invoice_tbody">
                <t t-set="has_downpayment" t-value="any(line.product_id and 'down' in (line.name or '').lower() for line in o.invoice_line_ids)"/>
                <t t-set="is_downpayment_invoice" t-value="'down' in (o.name or '').lower()"/>
                <t t-set="print_from_order_line" t-value="print_with_downpayment_lines and (has_downpayment or is_downpayment_invoice)"/>
                <t t-set="lines" t-value="print_from_order_line and o.invoice_line_ids.mapped('sale_line_ids').filtered(lambda l: l.order_id) or o.invoice_line_ids"/>

                <t t-foreach="lines" t-as="line">
                    <tr>
                        <td><span t-field="line.name"/></td>
                        <td class="text-end">
                            <span t-field="line.product_uom_qty" t-if="print_from_order_line"/>
                            <span t-field="line.quantity" t-else=""/>
                        </td>
                        <td class="text-end"><span t-field="line.price_unit"/></td>
                        <td class="text-end"><span t-field="line.discount"/></td>
                        <td class="text-end"><span t-field="line.price_subtotal"/></td>
                    </tr>
                </t>
            </tbody>
        </xpath>
    </template>
</odoo>
